╔════════════════════════════════════════════════════════════════════════════════╗
║                    AI STUDY COMPANION - CLEAN ARCHITECTURE                     ║
╚════════════════════════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────────────────────────┐
│                                  VIEW LAYER                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │  LoginView   │  │  MainView    │  │ SessionView  │  │   QuizView   │     │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                       │
│  │ MetricsView  │  │ UploadView   │  │ ScheduleView │                       │
│  └──────────────┘  └──────────────┘  └──────────────┘                       │
└────────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                         INTERFACE ADAPTERS LAYER                               │
│                                                                                │
│  ┌─────────────────────────── CONTROLLERS ────────────────────────────────┐   │
│  │  StartSession │ GenerateQuiz │ UploadMaterial │ Schedule │ ViewMetrics│   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                          │
│  ┌─────────────────────────── PRESENTERS ────────────────────────────────┐   │
│  │  StartSession │ GenerateQuiz │ AccountCreation │ Schedule │ Metrics   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                          │
│  ┌─────────────────────────── REPOSITORY INTERFACES ──────────────────────┐   │
│  │  UserRepository │ SessionRepository │ QuizRepository │ MaterialRepo    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                            USE CASES LAYER                                     │
│                                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │                         USE CASE INTERACTORS                            │  │
│  │                                                                         │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │  │
│  │  │ StartStudySession│  │  GenerateQuiz    │  │ UploadMaterial   │    │  │
│  │  │   Interactor     │  │   Interactor     │  │   Interactor     │    │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘    │  │
│  │                                                                         │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │  │
│  │  │DeleteMaterial    │  │ AccountCreation  │  │ScheduleSession   │    │  │
│  │  │   Interactor     │  │   Interactor     │  │   Interactor     │    │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘    │  │
│  │                                                                         │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐    │  │
│  │  │ SyncCalendar     │  │ ReviewQuizHistory│  │ ViewStudyMetrics │    │  │
│  │  │   Interactor     │  │   Interactor     │  │   Interactor     │    │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘    │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  Each Interactor has:                                                          │
│    • InputBoundary (interface)                                                 │
│    • InputData (DTO)                                                           │
│    • OutputBoundary (interface)                                                │
│    • OutputData (DTO)                                                          │
└────────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                            ENTITIES LAYER (DOMAIN)                             │
│                                                                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │    User     │  │   Course    │  │StudySession │  │ StudyQuiz   │         │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤         │
│  │ id          │  │ id          │  │ id          │  │ id          │         │
│  │ name        │  │ code        │  │ ownerUid    │  │ ownerUid    │         │
│  │ email       │  │ title       │  │ courseId    │  │ questions[] │         │
│  │ createdAt   │  │             │  │ startTime   │  │ score       │         │
│  └─────────────┘  └─────────────┘  │ endTime     │  │ prompt      │         │
│                                     │ duration    │  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐  │ quizId      │                           │
│  │  Question   │  │  Reference  │  │ status      │                           │
│  ├─────────────┤  │  Material   │  └─────────────┘                           │
│  │ id          │  ├─────────────┤                                             │
│  │ question    │  │ id          │                                             │
│  │ options[]   │  │ ownerUid    │                                             │
│  │ correctIdx  │  │ storagePath │                                             │
│  │ explanation │  │ filename    │                                             │
│  └─────────────┘  │ fingerprint │                                             │
│                   └─────────────┘                                             │
└────────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                    FRAMEWORKS & DRIVERS LAYER                                  │
│                                                                                │
│  ┌──────────────────────────── FIREBASE ───────────────────────────────┐     │
│  │                                                                      │     │
│  │  ┌─────────────────────┐  ┌─────────────────────┐                 │     │
│  │  │ FirebaseAuthService │  │  FirestoreService   │                 │     │
│  │  ├─────────────────────┤  ├─────────────────────┤                 │     │
│  │  │• createUserWithEmail│  │• saveDocument()     │                 │     │
│  │  │• signInWithEmail    │  │• getDocument()      │                 │     │
│  │  │• signInWithGoogle   │  │• queryDocuments()   │                 │     │
│  │  │• linkGoogleAccount  │  │• updateDocument()   │                 │     │
│  │  └─────────────────────┘  │• deleteDocument()   │                 │     │
│  │                            └─────────────────────┘                 │     │
│  │                                                                      │     │
│  │  ┌─────────────────────────────────────────────────────────────┐   │     │
│  │  │         Repository Implementations (Firestore)              │   │     │
│  │  │  • FirebaseUserRepositoryImpl                               │   │     │
│  │  │  • FirebaseStudySessionRepositoryImpl (TODO)                │   │     │
│  │  │  • FirebaseStudyQuizRepositoryImpl (TODO)                   │   │     │
│  │  │  • FirebaseReferenceMaterialRepositoryImpl (TODO)           │   │     │
│  │  └─────────────────────────────────────────────────────────────┘   │     │
│  └──────────────────────────────────────────────────────────────────────┘     │
│                                                                                │
│  ┌────────────────────────── STORAGE ────────────────────────────────┐       │
│  │  ┌─────────────────────┐                                          │       │
│  │  │   StorageService    │                                          │       │
│  │  ├─────────────────────┤                                          │       │
│  │  │• uploadFile()       │  → Firebase Storage                      │       │
│  │  │• downloadFile()     │  → PDF text extraction (PDFBox)          │       │
│  │  │• deleteFile()       │  → File fingerprinting (SHA-256)         │       │
│  │  │• getTextContent()   │                                          │       │
│  │  └─────────────────────┘                                          │       │
│  └────────────────────────────────────────────────────────────────────┘       │
│                                                                                │
│  ┌────────────────────────── GEMINI AI ─────────────────────────────┐        │
│  │  ┌─────────────────────┐                                          │        │
│  │  │   GeminiService     │                                          │        │
│  │  ├─────────────────────┤                                          │        │
│  │  │• generateQuiz()     │  → Gemini 2.0 Flash API                 │        │
│  │  │• uploadFileToGemini │  → Structured JSON output               │        │
│  │  │• buildPrompt()      │  → Context from reference materials     │        │
│  │  └─────────────────────┘                                          │        │
│  └────────────────────────────────────────────────────────────────────┘        │
│                                                                                │
│  ┌─────────────────────── GOOGLE CALENDAR ──────────────────────────┐        │
│  │  ┌─────────────────────┐  ┌─────────────────────┐               │        │
│  │  │GoogleCalendarService│  │   OAuthService      │               │        │
│  │  ├─────────────────────┤  ├─────────────────────┤               │        │
│  │  │• createAppCalendar()│  │• getAuthorizationUrl│               │        │
│  │  │• createEvent()      │  │• exchangeCodeFor    │               │        │
│  │  │• updateEvent()      │  │  Tokens()           │               │        │
│  │  │• deleteEvent()      │  │• refreshAccessToken │               │        │
│  │  │• initiateOAuthFlow()│  │• revokeToken()      │               │        │
│  │  └─────────────────────┘  └─────────────────────┘               │        │
│  └────────────────────────────────────────────────────────────────────┘        │
└────────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

                              DATA FLOW EXAMPLE
                          (Start Study Session Use Case)

1. USER ACTION
   └─> User clicks "Start Session" in StudySessionView

2. VIEW → CONTROLLER
   └─> StudySessionView calls StartStudySessionController.execute(userId, courseId, ...)

3. CONTROLLER → INPUT DATA
   └─> Controller creates StartStudySessionInputData(userId, courseId, startTime, ...)

4. CONTROLLER → INTERACTOR
   └─> Controller calls StartStudySessionInteractor.execute(inputData)

5. INTERACTOR → REPOSITORY
   └─> Interactor creates StudySession entity
   └─> Calls studySessionRepository.save(session)

6. REPOSITORY → FIRESTORE
   └─> FirebaseStudySessionRepositoryImpl converts entity to Map
   └─> Calls firestoreService.saveDocument("users/{uid}/studySessions/{id}", data)

7. INTERACTOR → PRESENTER
   └─> Interactor creates StartStudySessionOutputData(sessionId, startTime, courseId)
   └─> Calls outputBoundary.prepareSuccessView(outputData)

8. PRESENTER → VIEW
   └─> Presenter formats data and updates view
   └─> View displays "Session started!" and shows timer

═══════════════════════════════════════════════════════════════════════════════

                           DEPENDENCY DIRECTION
                          (All arrows point inward)

         Frameworks & Drivers  ──────────────────┐
                  │                              │
                  │                              │
                  ▼                              │
         Interface Adapters   ───────────────┐   │
                  │                          │   │
                  │                          │   │
                  ▼                          │   │
            Use Cases         ──────────┐    │   │
                  │                     │    │   │
                  │                     │    │   │
                  ▼                     │    │   │
             Entities                   │    │   │
                                        │    │   │
                                        │    │   │
         ← Dependencies point inward ───┴────┴───┘

═══════════════════════════════════════════════════════════════════════════════

Key Principles:
• Entities are pure domain logic (no framework dependencies)
• Use cases define business rules (framework-agnostic)
• Interface adapters convert data between layers
• Frameworks & drivers are the outermost layer (all external tools)
• Dependencies always point inward (outer layers depend on inner layers)
• Inner layers define interfaces, outer layers implement them

═══════════════════════════════════════════════════════════════════════════════

